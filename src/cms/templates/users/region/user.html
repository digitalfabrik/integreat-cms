{% extends "_base.html" %}

{% load i18n %}
{% load static %}
{% load widget_tweaks %}
{% load user_filters %}

{% block content %}
<form method="post">
    {% csrf_token %}
    <div class="flex flex-wrap mb-4">
        <div class="w-2/5 flex flex-wrap flex-col justify-center">
            <h2 class="heading font-normal">
	            {% if user_form.instance.id %}
		            {% with user_form.username.value as user_name %}
			            {% blocktrans %}Edit user "{{ user_name }}"{% endblocktrans %}
		            {% endwith %}
	            {% else %}
		            {% trans 'Create new user' %}
	            {% endif %}
            </h2>
        </div>
        <div class="w-3/5 flex justify-end">
            <input type="submit" name="submit" class="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded" value="{% trans 'Save' %}" />
        </div>
    </div>

    <div class="flex flex-wrap">
	    <div class="w-1/2 pr-2">
		    {{ user_form.errors }}
		    {{ user_profile_form.errors }}
		    <div class="w-full mb-4 rounded border border-solid border-gray-200 shadow bg-white">
				<div class="w-full p-4 rounded bg-blue-500">
					<h3 class="heading font-bold text-white">{% trans 'General Settings' %}</h3>
				</div>
				<div class="w-full p-4">

					<!-- General Options for user management -->
                    <label for="id_username" class="font-bold block p-2 mb-1 cursor-pointer">{% trans "Username" %}</label>
                    {% trans "Enter the username here" as username_placeholder%}
                    {% render_field user_form.username placeholder=username_placeholder class="appearance-none block w-full bg-gray-200 text-xl text-gray-800 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-400" %}

                    <label for="id_first_name" class="font-bold block p-2 mt-4 mb-1 cursor-pointer">{% trans "First name of the user" %}</label>
                    {% trans "Enter the user's first name here" as first_name_placeholder%}
                    {% render_field user_form.first_name placeholder=first_name_placeholder class="appearance-none block w-full bg-gray-200 text-xl text-gray-800 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-400" %}

                    <label for="id_last_name" class="font-bold block p-2 mt-4 mb-1 cursor-pointer">{% trans "Last name of the user" %}</label>
                    {% trans "Enter the user's last name here" as last_name_placeholder%}
                    {% render_field user_form.last_name placeholder=last_name_placeholder class="appearance-none block w-full bg-gray-200 text-xl text-gray-800 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-400" %}

                    <label for="id_email" class="font-bold block p-2 mt-4 mb-1 cursor-pointer">{% trans 'E-mail-address of the user' %}</label>
                    {% trans "Enter the user's e-mail-address here" as email_placeholder%}
                    {% render_field user_form.email placeholder=email_placeholder class="appearance-none block w-full bg-gray-200 text-xl text-gray-800 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-400" %}

                    <label for="id_password" class="font-bold block p-2 mt-4 cursor-pointer">{% trans 'Password of the user' %}</label>
                    <ul>
                        {% for item in user_form.password.help_text %}
                        <li class="py-1">{{ item }}</li>
                        {% endfor %}
                    </ul>
                    {% if user_form.instance.id %}{% trans 'Leave empty to keep unchanged' as password_placeholder%}{% else %}{% trans "Enter the user's password here" as password_placeholder%}{% endif %}
                    {% render_field user_form.password placeholder=password_placeholder class="appearance-none block w-full bg-gray-200 text-xl text-gray-800 border border-gray-200 rounded py-3 px-4 my-2 leading-tight focus:outline-none focus:bg-white focus:border-gray-400" %}

				</div>
			</div>
		</div>
        <div class="w-1/2 pl-2">
            <div class="w-full mb-4 rounded border border-solid border-gray-200 shadow bg-white">
                <div class="w-full p-4 rounded bg-blue-500">
                    <h3 class="heading font-bold text-white">{% trans 'Extended Settings' %}</h3>
                </div>

                <div class="w-full p-4">
                    <div class="py-4 border-b solid border-gray-200">
                        <label for="id_is_active" class="font-bold cursor-pointer mr-2">{% trans 'Active' %}</label>
                        {% render_field user_form.is_active %}
                    </div>

                    <div class="py-4 border-b solid border-gray-200">
                        <label for="id_expert_mode" class="font-bold mr-2 cursor-pointer">{% trans 'Expert mode' %}</label>
                        {% render_field user_profile_form.expert_mode %}
                        <p class="pt-2">
                            {% trans 'Enable this option to show up additional features like XLIFF import/export, page filtering, mirrored pages, page-based permissions, Do-Not-Translate-Tag and recurring events' %}
                        </p>
                    </div>

                    <div class="py-4 border-b solid border-gray-200">
                        <label for="id_roles" class="font-bold block mb-2 cursor-pointer">{% trans 'Roles' %}</label>
                        {% render_field user_form.roles class+="w-full" %}
                    </div>

                    <div class="pt-4 pb-2">
                        <label for="id_organization" class="font-bold block mb-2 cursor-pointer">{% trans 'Organization' %}</label>
                        {% render_field user_profile_form.organization class+="w-full"  %}
                    </div>
                </div>

            </div>
        </div>
        {% if user_form.instance.id %}
            {% if user_form.instance.profile.regions.count == 1 %}
                <div class="pt-2 pb-4">
                    <button title="{% trans 'Delete this user' %}" class="confirmation-button w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"
                            data-confirmation-title="{% trans 'Please confirm that you really want to delete this user' %}"
                            data-confirmation-text="{% trans 'This cannot be reversed.' %}"
                            data-confirmation-subject="{{ user_form.username.value }}"
                            data-action="{% url 'delete_region_user' region_slug=region.slug user_id=user_form.instance.id %}">
                        <i data-feather="trash-2" class="inline-block mr-2"></i>
                        {% trans 'Delete user' %}
                    </button>
                </div>
            {% else %}
                <div class="pt-2 pb-4">
                    <button title="{% blocktrans %}Remove this user from region {{ region }}{% endblocktrans %}" class="confirmation-button w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"
                            data-confirmation-title="{% blocktrans %}Please confirm that you really want to remove this user from region {{ region }}.{% endblocktrans %}"
                            data-confirmation-text="{% trans 'The user will keep access to the following regions:' %} {{ user_form.instance|remaining_regions:region|join:', ' }}"
                            data-confirmation-subject="{{ user_form.username.value }}"
                            data-action="{% url 'delete_region_user' region_slug=region.slug user_id=user_form.instance.id %}">
                        <i data-feather="trash-2" class="inline-block mr-2"></i>
                        {% trans 'Remove user from region' %}
                    </button>
                </div>
            {% endif %}
	    {% endif %}
    </div>
</form>

{% include "../../generic_confirmation_dialog.html" %}
{% endblock %}

{% block javascript %}
<script src="{% static 'js/confirmation-popups.js' %}"></script>
{% endblock %}
